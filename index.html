<html>
<head>Test47
<title>Bitcoin Price Index Watcher in HTML5</title>
<style type="text/css">
  #results {
    white-space: pre;
    text-align: center;
  }
</style>
</head>
<body>
  <div id="results" />
  
  <script type="text/javascript">
let output1
let output2
let tokensHeld
const apiEndpoints = [
    'https://chain.api.btc.com/v3/block/latest',
    'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd',
    'https://api.coingecko.com/api/v3/simple/price?ids=ice-rock-mining&vs_currencies=usd'
    
]

function loadApiData(url) {
    return fetch(url).then(response => response.json())
}

Promise.all(apiEndpoints.map(loadApiData))
    .then(stuffToDoAfterLoadedData)

function stuffToDoAfterLoadedData(data) {
    //Data In
    const currentDifficulty = data[0].data.difficulty
    const btcPrice = data[1].bitcoin.usd
    const marketPriceROCK2 = data[2].ice-rock-mining.usd
    
    //constants
    const averageDaysMonth = 30.44
    const blockReward = 13
    const totalTokens = 15724272
    const asic_S9_Count = 1960
    const asic_T17_Count = 0
    const miningEfficiency = 0.704
    const electricityPrice = 0.0422
    
    //Profit % shares
    const investorProft = 0.72
    const reinvestProfit = 0.18
    const iceRockManagementProfit = 0.1
    
    //ASIC S9
    const asic_S9_Revenue = (blockReward*btcPrice)/(currentDifficulty*(2**32)/(13500*1000000000)/86400)
    const asic_S9_Expense = (electricityPrice *1323*24)/1000
    const asic_S9_Profit = asic_S9_Revenue-asic_S9_Expense
    
    //ASIC T17
    const asic_T17_Revenue = (blockReward*btcPrice)/(currentDifficulty*(2**32)/(40000*1000000000)/86400)
    const asic_T17_Expense = (electricityPrice*2200*24)/1000
    const asic_T17_Profit = asic_T17_Revenue-asic_T17_Expense
    
    //Monthly calculation totals
    const totalMonthlyRevenue = ((asic_S9_Revenue*asic_S9_Count)+(asic_T17_Revenue*asic_T17_Count))*30.44*miningEfficiency
    const totalMonthlyProfit = ((asic_S9_Profit*asic_S9_Count)+(asic_T17_Profit*asic_T17_Count))*30.44*miningEfficiency
    const totalMonthlyElectricity = ((asic_S9_Expense*asic_S9_Count)+(asic_T17_Expense*asic_T17_Count))*30.44
    
    //Percentages
    const operatingCostPercentage = totalMonthlyElectricity/totalMonthlyRevenue
    const investorProfitPercentage = (1 - operatingCostPercentage)*investorProft
    
    const monthlyProfitPerToken = (investorProfitPercentage*totalMonthlyRevenue)/totalTokens
    
    //outputs
    const tokensHeld = 1000
    const tokenValue = tokensHeld
    const output1 = currentDifficulty 
    const output2 = btcPrice
    const monthlyProfit = tokensHeld * monthlyProfitPerToken
    const monthlyROI = 1
    const yearlyProfit = 1 
    const yearlyROI = 1
    

    document.getElementById("results").textContent = ` ${btcPrice}
    ${output2}
    ${monthlyProfit}`
}
</script>

  
</body>
</html>
